{
  "timestamp": "2025-12-14T14:46:22.584Z",
  "sha": "3f3fba7c4c2410e6cd6f9ab855aad17404308b79",
  "target": "staging",
  "envTarget": "staging",
  "dnsStatus": "PASS",
  "counts": {
    "pass": 7,
    "warn": 0,
    "skip": 11,
    "fail": 6
  },
  "results": [
    {
      "name": "verify:phase9b",
      "status": "FAIL",
      "command": "npm run verify:phase9b",
      "durationMs": 425,
      "output": "========================================\nPhase 9B Verification Harness\n========================================\n\n[FAIL] Environment Variables: Missing: SUPABASE_CONNECTION_STRING, STRIPE_SECRET_KEY, FEATURE_MONETIZATION_ENABLED\n\n\n---\n\n## Automated Verification Snapshot – Phase 9B\n\n- **Date:** 2025-12-14T14:46:05.360Z\n- **Checks:**\n  - ❌ Environment Variables: Missing: SUPABASE_CONNECTION_STRING, STRIPE_SECRET_KEY, FEATURE_MONETIZATION_ENABLED\n\n**Overall:** ❌ AUTOMATION FAILED\n> Note: Manual Stripe drill (Steps 4.1, 4.3) and production UI checks (Step 7) still required.\n> Use `DOCS/automation/PHASE_9B_OPERATOR_CHECKLIST.md` to continue."
    },
    {
      "name": "lint",
      "status": "PASS",
      "command": "npm run lint",
      "durationMs": 3125,
      "output": ""
    },
    {
      "name": "test",
      "status": "PASS",
      "command": "npm run test",
      "durationMs": 1003,
      "output": "\u001b[1m\u001b[46m RUN \u001b[49m\u001b[22m \u001b[36mv4.0.15 \u001b[39m\u001b[90m/Users/carlg/Documents/PROJECTS/Project-dev/DTD\u001b[39m\n\n \u001b[32m✓\u001b[39m tests/smoke/error-logging.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 4\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/app/directory/fetchDirectoryRegions.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 76\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/app/trainers/get_trainer_profile.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 96\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/alerts.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 96\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/app/api/onboarding/route.test.ts \u001b[2m(\u001b[22m\u001b[2m1 test\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 97\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/app/api/onboarding/route.integration.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 99\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/app/api/abn/verify/route.test.ts \u001b[2m(\u001b[22m\u001b[2m3 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 102\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/unit/monetization.test.ts \u001b[2m(\u001b[22m\u001b[2m3 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 7\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/lib/abr.test.ts \u001b[2m(\u001b[22m\u001b[2m6 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 6\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/unit/verifyLaunchClassifier.test.ts \u001b[2m(\u001b[22m\u001b[2m3 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 1\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m src/app/api/admin/ops/overrides/route.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 18\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/trainers.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 2\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/admin-pages.test.tsx \u001b[2m(\u001b[22m\u001b[2m4 tests\u001b[…"
    },
    {
      "name": "smoke",
      "status": "PASS",
      "command": "npm run smoke",
      "durationMs": 651,
      "output": "\u001b[1m\u001b[46m RUN \u001b[49m\u001b[22m \u001b[36mv4.0.15 \u001b[39m\u001b[90m/Users/carlg/Documents/PROJECTS/Project-dev/DTD\u001b[39m\n\n \u001b[32m✓\u001b[39m tests/smoke/error-logging.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 5\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/alerts.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 67\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/trainers.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 2\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/admin-pages.test.tsx \u001b[2m(\u001b[22m\u001b[2m4 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 9\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/emergency-api.test.ts \u001b[2m(\u001b[22m\u001b[2m3 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 5\u001b[2mms\u001b[22m\u001b[39m\n\n\u001b[2m Test Files \u001b[22m \u001b[1m\u001b[32m5 passed\u001b[39m\u001b[22m\u001b[90m (5)\u001b[39m\n\u001b[2m      Tests \u001b[22m \u001b[1m\u001b[32m13 passed\u001b[39m\u001b[22m\u001b[90m (13)\u001b[39m\n\u001b[2m   Start at \u001b[22m 01:46:09\n\u001b[2m   Duration \u001b[22m 230ms\u001b[2m (transform 324ms, setup 0ms, import 424ms, tests 88ms, environment 0ms)\u001b[22m"
    },
    {
      "name": "e2e",
      "status": "PASS",
      "command": "npm run e2e",
      "durationMs": 6474,
      "output": "Running 8 tests using 4 workers\n\n  ✓  2 [chromium] › tests/e2e/alerts-snapshot.spec.ts:3:1 › alerts snapshot healthy baseline (235ms)\n  ✓  1 [chromium] › tests/e2e/emergency.spec.ts:5:1 › Emergency controls toggle state and capture screenshot (1.4s)\n  ✓  4 [chromium] › tests/e2e/admin-dashboards.spec.ts:86:3 › Admin dashboards › AI health dashboard shows override state (1.6s)\n  ✓  3 [chromium] › tests/e2e/monetization.spec.ts:178:3 › Monetization upgrade flow › provider upgrade and admin subscription tab (1.9s)\n  ✓  7 [chromium] › tests/e2e/monetization.spec.ts:203:3 › Monetization upgrade flow › hides upgrade CTA when feature flag disabled (370ms)\n  ✓  6 [chromium] › tests/e2e/admin-dashboards.spec.ts:99:3 › Admin dashboards › Cron health dashboard renders schedule snapshot (747ms)\n  ✓  5 [chromium] › tests/e2e/search-and-trainer.spec.ts:19:3 › Search → Trainer profile › navigates from search results to trainer profile (2.4s)\n  ✓  8 [chromium] › tests/e2e/monetization.spec.ts:209:3 › Monetization upgrade flow › requires ABN verification before upgrade (260ms)\n\n  8 passed (5.8s)"
    },
    {
      "name": "preprod (staging)",
      "status": "FAIL",
      "command": "./scripts/preprod_verify.sh",
      "durationMs": 5089,
      "output": "========================================\nRunning Type Check\n[PASS] Type Check\n========================================\nRunning Smoke Tests\n\n\u001b[1m\u001b[46m RUN \u001b[49m\u001b[22m \u001b[36mv4.0.15 \u001b[39m\u001b[90m/Users/carlg/Documents/PROJECTS/Project-dev/DTD\u001b[39m\n\n \u001b[32m✓\u001b[39m tests/smoke/error-logging.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 5\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/alerts.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 60\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/trainers.test.ts \u001b[2m(\u001b[22m\u001b[2m2 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 2\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/admin-pages.test.tsx \u001b[2m(\u001b[22m\u001b[2m4 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 8\u001b[2mms\u001b[22m\u001b[39m\n \u001b[32m✓\u001b[39m tests/smoke/emergency-api.test.ts \u001b[2m(\u001b[22m\u001b[2m3 tests\u001b[22m\u001b[2m)\u001b[22m\u001b[32m 6\u001b[2mms\u001b[22m\u001b[39m\n\n\u001b[2m Test Files \u001b[22m \u001b[1m\u001b[32m5 passed\u001b[39m\u001b[22m\u001b[90m (5)\u001b[39m\n\u001b[2m      Tests \u001b[22m \u001b[1m\u001b[32m13 passed\u001b[39m\u001b[22m\u001b[90m (13)\u001b[39m\n\u001b[2m   Start at \u001b[22m 01:46:18\n\u001b[2m   Duration \u001b[22m 204ms\u001b[2m (transform 316ms, setup 0ms, import 418ms, tests 82ms, environment 0ms)\u001b[22m\n\n[PASS] Smoke Tests\n========================================\nRunning Lint\n[PASS] Lint\n========================================\nRunning Doc Divergence Detector\n::error ::New/modified DOCS markdown files must include an SSOT badge, archive banner, or the explicit opt-out comment.\n  - DOCS/automation/LAUNCH_WORKFLOW_N1.md\n[FAIL] Doc Divergence Detector\n========================================\nRunning Env Ready Check\n========================================\nRunnin…"
    },
    {
      "name": "check_env_ready staging",
      "status": "FAIL",
      "command": "./scripts/check_env_ready.sh staging",
      "durationMs": 24,
      "output": "========================================\nRunning Env Ready Check (target: staging)\nMissing environment variables:\n  - NEXT_PUBLIC_SUPABASE_URL\n  - NEXT_PUBLIC_SUPABASE_ANON_KEY\n  - SUPABASE_PGCRYPTO_KEY\n  - SUPABASE_URL\n  - SUPABASE_SERVICE_ROLE_KEY\n  - SUPABASE_CONNECTION_STRING\n  - ABR_GUID\n  - STRIPE_SECRET_KEY\n  - STRIPE_WEBHOOK_SECRET\n  - ZAI_API_KEY\n  - ZAI_BASE_URL\n  - LLM_DEFAULT_MODEL\n  - FEATURE_MONETIZATION_ENABLED\n  - NEXT_PUBLIC_FEATURE_MONETIZATION_ENABLED\n  - STRIPE_PRICE_FEATURED\n  - STRIPE_PRICE_PRO\n  - ALERTS_EMAIL_TO\n  - ALERTS_SLACK_WEBHOOK_URL\n[FAIL] Env Ready Check"
    },
    {
      "name": "alerts dry-run",
      "status": "FAIL",
      "command": "npx tsx scripts/run_alerts_email.ts --dry-run",
      "durationMs": 540,
      "output": "/Users/carlg/Documents/PROJECTS/Project-dev/DTD/node_modules/@supabase/supabase-js/src/lib/helpers.ts:86\n    throw new Error('supabaseUrl is required.')\n          ^\n\n\nError: supabaseUrl is required.\n    at validateSupabaseUrl (/Users/carlg/Documents/PROJECTS/Project-dev/DTD/node_modules/@supabase/supabase-js/src/lib/helpers.ts:86:11)\n    at new SupabaseClient (/Users/carlg/Documents/PROJECTS/Project-dev/DTD/node_modules/@supabase/supabase-js/src/SupabaseClient.ts:117:40)\n    at createClient (/Users/carlg/Documents/PROJECTS/Project-dev/DTD/node_modules/@supabase/supabase-js/src/index.ts:54:10)\n    at <anonymous> (/Users/carlg/Documents/PROJECTS/Project-dev/DTD/src/lib/supabase.ts:6:25)\n    at ModuleJob.run (node:internal/modules/esm/module_job:263:25)\n    at async ModuleLoader.import (node:internal/modules/esm/loader:540:24)\n    at async asyncRunEntryPointWithESMLoader (node:internal/modules/run_main:117:5)\n\nNode.js v20.19.2"
    },
    {
      "name": "DB target",
      "status": "FAIL",
      "durationMs": 0,
      "output": "SUPABASE_CONNECTION_STRING not set"
    },
    {
      "name": "DNS root → Vercel",
      "status": "PASS",
      "durationMs": 91,
      "details": {
        "expected": "cname.vercel-dns.com.",
        "cnameRecords": [],
        "aRecords": [
          "216.198.79.1",
          "64.29.17.65"
        ],
        "aaaaRecords": [],
        "optional": false
      }
    },
    {
      "name": "DNS www → Vercel (optional)",
      "status": "PASS",
      "durationMs": 99,
      "details": {
        "expected": "cname.vercel-dns.com.",
        "cnameRecords": [],
        "aRecords": [
          "64.29.17.1",
          "64.29.17.65"
        ],
        "aaaaRecords": [],
        "optional": true
      }
    },
    {
      "name": "DNS staging preview model",
      "status": "SKIP",
      "durationMs": 0,
      "output": "Staging uses Vercel Preview deployments; no staging subdomain by design."
    },
    {
      "name": "Production curl",
      "status": "PASS",
      "durationMs": 112,
      "output": "HTTP/2 307"
    },
    {
      "name": "Monetization flags (staging env)",
      "status": "FAIL",
      "durationMs": 0,
      "details": {
        "FEATURE_MONETIZATION_ENABLED": "unset",
        "NEXT_PUBLIC_FEATURE_MONETIZATION_ENABLED": "unset"
      }
    },
    {
      "name": "Secrets alignment (.env vs Vercel) – item 4c",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Requires Vercel dashboard + secret rotation approvals."
      }
    },
    {
      "name": "Stripe monetization drill – item 8b",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Live Stripe payment and webhook replay need human supervision."
      }
    },
    {
      "name": "Production payouts + compliance review – item 9b",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Requires finance + compliance teams sign-off."
      }
    },
    {
      "name": "Production admin toggles – item 10c",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Vercel/Stripe toggles enforced during final go/no-go."
      }
    },
    {
      "name": "Stripe live upgrade path – item 10d",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Must be exercised with real card + observers."
      }
    },
    {
      "name": "Stripe invoice sanity – item 10f",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Needs invoice PDF inspection + accounting approval."
      }
    },
    {
      "name": "Production governance approvals – item 11b",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Board/governance approvals cannot be automated."
      }
    },
    {
      "name": "Legal sign-off + comms – item 11c",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Requires legal + comms leads to sign launch docs."
      }
    },
    {
      "name": "Production monetization flags – item 10e",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Needs Vercel production env inspect via MCP/browser."
      }
    },
    {
      "name": "Production DNS evidence – item 11a",
      "status": "SKIP",
      "durationMs": 0,
      "details": {
        "reason": "Needs DNS provider screenshots/API (MCP) for production domain."
      }
    }
  ]
}